# Система сброса скролла

Этот документ описывает систему автоматического сброса скролла при переходе между страницами в приложении.

## Компоненты системы

### 1. ScrollToTop (компонент)
**Файл:** `src/components/ScrollToTop.jsx`

Автоматически сбрасывает скролл при изменении маршрута. Используется глобально в `App.jsx`.

**Особенности:**
- Исключение для переходов с кнопки "Смотреть все" (когда есть state с категорией)
- В таких случаях скролл не сбрасывается, а происходит плавная прокрутка к области с карточками

```jsx
import ScrollToTop from './components/ScrollToTop';

// В App.jsx
<Router>
  <ScrollToTop />
  {/* остальные компоненты */}
</Router>
```

### 2. useScrollToTop (хук)
**Файл:** `src/hooks/useScrollToTop.js`

Хук для использования в отдельных компонентах страниц.

**Особенности:**
- Исключение для переходов с кнопки "Смотреть все"
- Автоматически сбрасывает скролл при монтировании компонента

```jsx
import useScrollToTop from '../hooks/useScrollToTop';

const MyPage = () => {
  useScrollToTop(); // Автоматически сбрасывает скролл при монтировании компонента
  
  return <div>Содержимое страницы</div>;
};
```

### 3. useScrollToTopWithException (хук)
**Файл:** `src/hooks/useScrollToTopWithException.js`

Специальный хук для обработки исключений при сбросе скролла.

```jsx
import useScrollToTopWithException from '../hooks/useScrollToTopWithException';

const MyPage = () => {
  useScrollToTopWithException(); // Сбрасывает скролл с учетом исключений
  
  return <div>Содержимое страницы</div>;
};
```

### 4. PageTransition (компонент)
**Файл:** `src/components/PageTransition.jsx`

Компонент для анимации переходов между страницами с автоматическим сбросом скролла.

```jsx
import PageTransition from '../components/PageTransition';

const MyPage = () => {
  return (
    <PageTransition>
      <div>Содержимое страницы</div>
    </PageTransition>
  );
};
```

### 5. ScrollToTopButton (компонент)
**Файл:** `src/components/ScrollToTopButton.jsx`

Кнопка для ручного сброса скролла. Появляется после прокрутки на 300px вниз.

```jsx
import ScrollToTopButton from './components/ScrollToTopButton';

// В App.jsx
<ScrollToTopButton />
```

### 6. scrollUtils (утилиты)
**Файл:** `src/utils/scrollUtils.js`

Набор утилит для управления скроллом.

```jsx
import { scrollToTop, scrollToElement, getScrollPosition } from '../utils/scrollUtils';

// Плавная прокрутка к началу
scrollToTop({ easing: 'smooth' });

// Прокрутка к элементу
scrollToElement('#my-element', { offset: 100 });

// Получение текущей позиции
const position = getScrollPosition();
```

## Варианты использования

### Автоматический сброс скролла
Система автоматически сбрасывает скролл при переходе на новую страницу благодаря компоненту `ScrollToTop` в `App.jsx`.

### Исключение для кнопки "Смотреть все"
Когда пользователь нажимает кнопку "Смотреть все" в категориях:
1. Скролл НЕ сбрасывается в начало страницы
2. Происходит плавная прокрутка к области с карточками товаров
3. Автоматически применяется фильтр по выбранной категории
4. Карточки остаются видимыми для пользователя

### Ручной сброс скролла
Пользователи могут использовать кнопку "Наверх" (ScrollToTopButton), которая появляется в правом нижнем углу после прокрутки.

### Программный сброс скролла
```jsx
import { scrollToTop } from '../utils/scrollUtils';

const handleButtonClick = () => {
  scrollToTop({ easing: 'smooth' });
};
```

## Логика исключений

### Когда скролл НЕ сбрасывается:
- Переход с кнопки "Смотреть все" (есть `state.category`)
- Переходы внутри одной страницы с параметрами
- Переходы с сохранением контекста

### Когда скролл сбрасывается:
- Обычные переходы между страницами
- Переходы через навигационное меню
- Переходы по прямым ссылкам

## Настройки

### Типы анимации
- `'smooth'` - нативная плавная прокрутка (по умолчанию)
- `'custom'` - кастомная анимация с easeInOut
- `'instant'` - мгновенная прокрутка

### Задержка
Система использует задержку в 100ms для корректной работы с анимациями переходов между страницами.

### Порог видимости кнопки
Кнопка "Наверх" появляется после прокрутки на 300px вниз (настраивается в `ScrollToTopButton.jsx`).

### Отступ для прокрутки к карточкам
При переходе с кнопки "Смотреть все" используется отступ 100px от верха для учета навигации.

## Совместимость

Система работает с:
- React Router v6
- Framer Motion
- Кастомным скроллбаром
- Темной/светлой темой

## Производительность

- Использует `requestAnimationFrame` для плавных анимаций
- Оптимизирована для предотвращения лишних перерендеров
- Автоматически очищает event listeners
- Умная логика исключений предотвращает ненужные операции
